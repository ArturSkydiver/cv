import React, { useCallback, useState } from 'react';
import cx from 'classnames';

import s from './styles.module.scss';

const THEME = 'theme';

type Theme = 'dark' | 'light';

let isDarkTheme = false;
const savedTheme = localStorage.getItem(THEME) as Theme;
if (savedTheme) {
  isDarkTheme = savedTheme === 'dark';
} else if (window.matchMedia) {
  isDarkTheme = window.matchMedia('(prefers-color-scheme: dark)').matches;
}
if (isDarkTheme) {
  document.documentElement.setAttribute('data-theme', 'dark');
}

type Props = {
  className?: string;
};

export default ({ className }: Props): JSX.Element => {
  const [theme, setTheme] = useState<Theme>(
    document.documentElement.getAttribute('data-theme') as Theme
  );

  const toggleTheme = useCallback(() => {
    const newTheme = theme === 'dark' ? 'light' : 'dark';
    setTheme(newTheme);
    localStorage.setItem(THEME, newTheme);
    document.documentElement.setAttribute('data-theme', newTheme);
  }, [theme]);

  return (
    <label className={cx(s.root, className)}>
      <input
        type="checkbox"
        checked={theme === 'dark'}
        onClick={toggleTheme}
        onChange={() => null}
      />
      <div className={s.toggle}>
        <svg
          width="12"
          height="12"
          viewBox="0 0 12 12"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          className={cx(s.toggle_icon, theme === 'light' && s.toggle_icon_show)}
        >
          <path
            d="M6.00022 3.27246C5.2769 3.27246 4.58321 3.5598 4.07175 4.07126C3.56029 4.58272 3.27295 5.27642 3.27295 5.99973C3.27295 6.72305 3.56029 7.41674 4.07175 7.92821C4.58321 8.43967 5.2769 8.72701 6.00022 8.72701C6.72354 8.72701 7.41723 8.43967 7.9287 7.92821C8.44016 7.41674 8.72749 6.72305 8.72749 5.99973C8.72749 5.27642 8.44016 4.58272 7.9287 4.07126C7.41723 3.5598 6.72354 3.27246 6.00022 3.27246V3.27246Z"
            fill="white"
          />
          <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M6 0C6.14466 0 6.2834 0.0574673 6.38569 0.15976C6.48799 0.262052 6.54545 0.400791 6.54545 0.545455V1.09091C6.54545 1.23557 6.48799 1.37431 6.38569 1.4766C6.2834 1.5789 6.14466 1.63636 6 1.63636C5.85534 1.63636 5.7166 1.5789 5.61431 1.4766C5.51201 1.37431 5.45455 1.23557 5.45455 1.09091V0.545455C5.45455 0.400791 5.51201 0.262052 5.61431 0.15976C5.7166 0.0574673 5.85534 0 6 0V0ZM1.25073 1.25073C1.35302 1.14847 1.49173 1.09103 1.63636 1.09103C1.781 1.09103 1.91971 1.14847 2.022 1.25073L2.84018 2.06891C2.93954 2.17178 2.99452 2.30957 2.99328 2.45258C2.99203 2.5956 2.93467 2.73241 2.83354 2.83354C2.73241 2.93467 2.5956 2.99203 2.45258 2.99328C2.30957 2.99452 2.17178 2.93954 2.06891 2.84018L1.25073 2.022C1.14847 1.91971 1.09103 1.781 1.09103 1.63636C1.09103 1.49173 1.14847 1.35302 1.25073 1.25073V1.25073ZM10.7493 1.25073C10.8515 1.35302 10.909 1.49173 10.909 1.63636C10.909 1.781 10.8515 1.91971 10.7493 2.022L9.93109 2.84018C9.88078 2.89228 9.82059 2.93383 9.75404 2.96242C9.68749 2.99101 9.61592 3.00605 9.54349 3.00668C9.47107 3.00731 9.39924 2.99351 9.33221 2.96608C9.26517 2.93866 9.20427 2.89816 9.15306 2.84694C9.10184 2.79573 9.06134 2.73483 9.03392 2.66779C9.00649 2.60076 8.99269 2.52893 8.99332 2.45651C8.99395 2.38408 9.00899 2.31251 9.03758 2.24596C9.06617 2.17941 9.10772 2.11923 9.15982 2.06891L9.978 1.25073C10.0803 1.14847 10.219 1.09103 10.3636 1.09103C10.5083 1.09103 10.647 1.14847 10.7493 1.25073ZM0 6C0 5.85534 0.0574673 5.7166 0.15976 5.61431C0.262052 5.51201 0.400791 5.45455 0.545455 5.45455H1.09091C1.23557 5.45455 1.37431 5.51201 1.4766 5.61431C1.5789 5.7166 1.63636 5.85534 1.63636 6C1.63636 6.14466 1.5789 6.2834 1.4766 6.38569C1.37431 6.48799 1.23557 6.54545 1.09091 6.54545H0.545455C0.400791 6.54545 0.262052 6.48799 0.15976 6.38569C0.0574673 6.2834 0 6.14466 0 6ZM10.3636 6C10.3636 5.85534 10.4211 5.7166 10.5234 5.61431C10.6257 5.51201 10.7644 5.45455 10.9091 5.45455H11.4545C11.5992 5.45455 11.7379 5.51201 11.8402 5.61431C11.9425 5.7166 12 5.85534 12 6C12 6.14466 11.9425 6.2834 11.8402 6.38569C11.7379 6.48799 11.5992 6.54545 11.4545 6.54545H10.9091C10.7644 6.54545 10.6257 6.48799 10.5234 6.38569C10.4211 6.2834 10.3636 6.14466 10.3636 6ZM2.84018 9.15982C2.94244 9.26211 2.99988 9.40082 2.99988 9.54545C2.99988 9.69009 2.94244 9.8288 2.84018 9.93109L2.022 10.7493C1.91913 10.8486 1.78134 10.9036 1.63833 10.9024C1.49531 10.9011 1.3585 10.8438 1.25737 10.7426C1.15624 10.6415 1.09888 10.5047 1.09763 10.3617C1.09639 10.2187 1.15137 10.0809 1.25073 9.978L2.06891 9.15982C2.1712 9.05756 2.30991 9.00012 2.45455 9.00012C2.59918 9.00012 2.73789 9.05756 2.84018 9.15982V9.15982ZM9.15982 9.15982C9.26211 9.05756 9.40082 9.00012 9.54545 9.00012C9.69009 9.00012 9.8288 9.05756 9.93109 9.15982L10.7493 9.978C10.8486 10.0809 10.9036 10.2187 10.9024 10.3617C10.9011 10.5047 10.8438 10.6415 10.7426 10.7426C10.6415 10.8438 10.5047 10.9011 10.3617 10.9024C10.2187 10.9036 10.0809 10.8486 9.978 10.7493L9.15982 9.93109C9.05756 9.8288 9.00012 9.69009 9.00012 9.54545C9.00012 9.40082 9.05756 9.26211 9.15982 9.15982ZM6 10.3636C6.14466 10.3636 6.2834 10.4211 6.38569 10.5234C6.48799 10.6257 6.54545 10.7644 6.54545 10.9091V11.4545C6.54545 11.5992 6.48799 11.7379 6.38569 11.8402C6.2834 11.9425 6.14466 12 6 12C5.85534 12 5.7166 11.9425 5.61431 11.8402C5.51201 11.7379 5.45455 11.5992 5.45455 11.4545V10.9091C5.45455 10.7644 5.51201 10.6257 5.61431 10.5234C5.7166 10.4211 5.85534 10.3636 6 10.3636V10.3636Z"
            fill="white"
          />
        </svg>
        <svg
          width="12"
          height="12"
          viewBox="0 0 12 12"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          className={cx(s.toggle_icon, theme === 'dark' && s.toggle_icon_show)}
        >
          <path
            d="M8.08886 0.375C8.71563 1.3028 9.05006 2.39709 9.04905 3.51675C9.04905 6.64819 6.48293 9.18675 3.31718 9.18675C2.28216 9.18867 1.26583 8.91109 0.375488 8.38331C1.35199 10.3056 3.36218 11.625 5.68493 11.625C8.9658 11.625 11.6253 8.99419 11.6253 5.74875C11.6253 3.35006 10.1714 1.28831 8.08886 0.375Z"
            fill="white"
          />
        </svg>
      </div>
      <div className={s.back} />
    </label>
  );
};
